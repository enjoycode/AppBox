var Xe=Object.defineProperty;var Ye=(l,e,i)=>e in l?Xe(l,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[e]=i;var o=(l,e,i)=>(Ye(l,typeof e!="symbol"?e+"":e,i),i),Ve=(l,e,i)=>{if(!e.has(l))throw TypeError("Cannot "+i)};var h=(l,e,i)=>(Ve(l,e,"read from private field"),i?i.call(l):e.get(l)),c=(l,e,i)=>{if(e.has(l))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(l):e.set(l,i)},m=(l,e,i,n)=>(Ve(l,e,"write to private field"),n?n.call(l,i):e.set(l,i),i);import*as u from"/System.js";import{List as Pe,initializeSystem as Ze}from"/System.js";import*as t from"/PixUI.js";import*as I from"/AppBoxClient.js";import{initializeAppBoxClient as et,Channel as tt,WebChannel as it}from"/AppBoxClient.js";import*as d from"/AppBoxCore.js";import{TypeSerializer as g,PayloadType as y,FieldWithOrder as nt}from"/AppBoxCore.js";import*as ue from"/CodeEditor.js";import{TSCSharpLanguage as ot}from"/CodeEditor.js";const rt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const _ of s.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&n(_)}).observe(document,{childList:!0,subtree:!0});function i(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=i(r);fetch(r.href,s)}};rt();const lt="modulepreload",We={},st="/",dt=function(e,i){return!i||i.length===0?e():Promise.all(i.map(n=>{if(n=`${st}${n}`,n in We)return;We[n]=!0;const r=n.endsWith(".css"),s=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${s}`))return;const _=document.createElement("link");if(_.rel=r?"stylesheet":lt,r||(_.as="script",_.crossOrigin=""),_.href=n,document.head.appendChild(_),r)return new Promise((ge,Qe)=>{_.addEventListener("load",ge),_.addEventListener("error",()=>Qe(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e())};class at extends t.View{constructor(e){super();o(this,"_controller");o(this,"_version",0);e.InvalidateAction=()=>this.Run(),this._controller=e}async Run(){this._version++;const e="/preview/view/"+I.Channel.SessionId+"/"+this._controller.ModelNode.Id+"?v="+this._version;try{let i=await dt(()=>import(e),[]),n=i[this._controller.ModelNode.Label.Value].Preview,r;n?r=n():r=new i[this._controller.ModelNode.Label.Value],this.Child=new t.Container().Init({Child:r}),this.Invalidate(t.InvalidAction.Relayout),this._controller.CurrentWidget=r,this._controller.RefreshOutlineAction?.call(this)}catch(i){console.warn("\u83B7\u53D6\u9884\u89C8\u5931\u8D25: ",i)}}OnMounted(){super.OnMounted(),this.Run()}}var p=(l=>(l[l.ApplicationRoot=0]="ApplicationRoot",l[l.DataStoreRootNode=1]="DataStoreRootNode",l[l.DataStoreNode=2]="DataStoreNode",l[l.ApplicationNode=3]="ApplicationNode",l[l.ModelRootNode=4]="ModelRootNode",l[l.FolderNode=5]="FolderNode",l[l.ModelNode=6]="ModelNode",l))(p||{});class ut{constructor(){o(this,"ModelType","");o(this,"ModelId","")}WriteTo(e){throw new u.NotSupportedException}ReadFrom(e){this.ModelType=e.ReadString(),this.ModelId=e.ReadString()}}class ht{constructor(){o(this,"StartLine",0);o(this,"StartColumn",0);o(this,"EndLine",0);o(this,"EndColumn",0);o(this,"IsError",!1);o(this,"Message","")}get Position(){return`[${this.StartLine+1}, ${this.StartColumn}] - [${this.EndLine+1}, ${this.EndColumn}]`}WriteTo(e){throw new u.NotSupportedException}ReadFrom(e){this.StartLine=e.ReadInt(),this.StartColumn=e.ReadInt(),this.EndLine=e.ReadInt(),this.EndColumn=e.ReadInt(),this.IsError=e.ReadBool(),this.Message=e.ReadString()}}var R,D,E,b;class ct{constructor(){c(this,R,0);c(this,D,void 0);c(this,E,!1);c(this,b,void 0)}get IndexId(){return h(this,R)}set IndexId(e){m(this,R,e)}get Name(){return h(this,D)}set Name(e){m(this,D,e)}get Unique(){return h(this,E)}set Unique(e){m(this,E,e)}get Fields(){return h(this,b)}set Fields(e){m(this,b,e)}WriteTo(e){throw new u.NotSupportedException}ReadFrom(e){this.IndexId=e.ReadByte(),this.Name=e.ReadString(),this.Unique=e.ReadBool(),this.Fields=new Array(e.ReadVariant()).fill(d.FieldWithOrder.Empty.Clone());for(let i=0;i<this.Fields.length;i++)this.Fields[i].ReadFrom(e)}}R=new WeakMap,D=new WeakMap,E=new WeakMap,b=new WeakMap;class mt extends ct{}var x,O,A;class pt{constructor(){c(this,x,0n);c(this,O,void 0);c(this,A,void 0)}get StoreModelId(){return h(this,x)}set StoreModelId(e){m(this,x,e)}get PrimaryKeys(){return h(this,O)}set PrimaryKeys(e){m(this,O,e)}get Indexes(){return h(this,A)}set Indexes(e){m(this,A,e)}ReadFrom(e){this.StoreModelId=e.ReadLong();let i=e.ReadVariant();this.PrimaryKeys=new u.List;for(let r=0;r<i;r++){let s=new d.FieldWithOrder;s.ReadFrom(e),this.PrimaryKeys.Add(s.Clone())}let n=e.ReadVariant();this.Indexes=new u.List;for(let r=0;r<n;r++){let s=new mt;s.ReadFrom(e),this.Indexes.Add(s)}}}x=new WeakMap,O=new WeakMap,A=new WeakMap;var B;class Te{constructor(){c(this,B,0);o(this,"Name");o(this,"AllowNull",!1);o(this,"Comment")}get Id(){return h(this,B)}set Id(e){m(this,B,e)}get IsForeignKeyMember(){return this.Type==d.EntityMemberType.EntityField&&this.IsForeignKey}toString(){return this.Name}WriteTo(e){throw new u.NotSupportedException}ReadFrom(e){this.Id=e.ReadShort(),this.Name=e.ReadString(),this.AllowNull=e.ReadBool(),this.Comment=e.ReadString()}}B=new WeakMap;var v,L;class ke extends Te{constructor(){super(...arguments);c(this,v,0);c(this,L,!1);o(this,"EnumModelId");o(this,"Length",0);o(this,"Decimals",0)}get Type(){return d.EntityMemberType.EntityField}get FieldType(){return h(this,v)}set FieldType(e){m(this,v,e)}get IsForeignKey(){return h(this,L)}set IsForeignKey(e){m(this,L,e)}ReadFrom(e){super.ReadFrom(e),this.FieldType=e.ReadByte(),this.IsForeignKey=e.ReadBool(),this.FieldType==d.EntityFieldType.Enum&&(this.EnumModelId=e.ReadLong()),this.Length=e.ReadVariant(),this.Decimals=e.ReadVariant()}}v=new WeakMap,L=new WeakMap;var V;class Me extends Te{constructor(){super(...arguments);o(this,"RefModelIds",new u.List);c(this,V,void 0);o(this,"IsReverse",!1);o(this,"IsAggregationRef",!1);o(this,"IsForeignKeyConstraint",!1)}get Type(){return d.EntityMemberType.EntityRef}get FKMemberIds(){return h(this,V)}set FKMemberIds(e){m(this,V,e)}ReadFrom(e){super.ReadFrom(e),this.IsReverse=e.ReadBool(),this.IsAggregationRef=e.ReadBool(),this.IsForeignKeyConstraint=e.ReadBool();let i=e.ReadVariant();for(let n=0;n<i;n++)this.RefModelIds.Add(e.ReadLong());i=e.ReadVariant(),this.FKMemberIds=new Int16Array(i);for(let n=0;n<i;n++)this.FKMemberIds[n]=e.ReadShort()}}V=new WeakMap;class Ke extends Te{constructor(){super(...arguments);o(this,"RefModelId",0n);o(this,"RefMemberId",0)}get Type(){return d.EntityMemberType.EntitySet}ReadFrom(e){super.ReadFrom(e),this.RefModelId=e.ReadLong(),this.RefMemberId=e.ReadShort()}}class It{constructor(){o(this,"IsNew",!1);o(this,"Members",new u.List);o(this,"DataStoreKind",0);o(this,"_storeOptions")}get SqlStoreOptions(){return this._storeOptions}WriteTo(e){throw new u.NotSupportedException}ReadFrom(e){if(this.IsNew=e.ReadBool(),this.DataStoreKind=e.ReadByte(),this.DataStoreKind==d.DataStoreKind.Sql){let n=new pt;n.ReadFrom(e),this._storeOptions=n}let i=e.ReadVariant();for(let n=0;n<i;n++){let r=e.ReadByte(),s;switch(r){case d.EntityMemberType.EntityField:s=new ke;break;case d.EntityMemberType.EntityRef:s=new Me;break;case d.EntityMemberType.EntitySet:s=new Ke;break;default:throw new u.NotImplementedException}s.ReadFrom(e),this.Members.Add(s)}}}class Ct{constructor(){o(this,"AppName");o(this,"ModelName");o(this,"MemberName");o(this,"ModelId");o(this,"MemberId",0)}toString(){return`${this.AppName}.${this.ModelName}.${this.MemberName}`}WriteTo(e){throw new u.NotSupportedException}ReadFrom(e){this.AppName=e.ReadString(),this.ModelName=e.ReadString(),this.MemberName=e.ReadString(),this.ModelId=e.ReadString(),this.MemberId=e.ReadShort()}}var P,W,G,k,K,$;class wt{constructor(){c(this,P,void 0);c(this,W,void 0);c(this,G,void 0);c(this,k,-1);c(this,K,-1);c(this,$,-1)}get ModelId(){return h(this,P)}set ModelId(e){m(this,P,e)}get ModelName(){return h(this,W)}set ModelName(e){m(this,W,e)}get Location(){return h(this,G)}set Location(e){m(this,G,e)}get Offset(){return h(this,k)}set Offset(e){m(this,k,e)}get Length(){return h(this,K)}set Length(e){m(this,K,e)}get TargetType(){return h(this,$)}set TargetType(e){m(this,$,e)}WriteTo(e){throw new u.NotSupportedException}ReadFrom(e){this.ModelId=e.ReadString(),this.ModelName=e.ReadString(),this.Location=e.ReadString(),this.Offset=e.ReadVariant(),this.Length=e.ReadVariant(),this.TargetType=e.ReadVariant()}}P=new WeakMap,W=new WeakMap,G=new WeakMap,k=new WeakMap,K=new WeakMap,$=new WeakMap;var U,z,H;class _t{constructor(){c(this,U,0);c(this,z,0);c(this,H,void 0)}get Offset(){return h(this,U)}set Offset(e){m(this,U,e)}get Length(){return h(this,z)}set Length(e){m(this,z,e)}get Text(){return h(this,H)}set Text(e){m(this,H,e)}WriteTo(e){throw new u.NotSupportedException}ReadFrom(e){this.Offset=e.ReadInt(),this.Length=e.ReadInt(),this.Text=e.ReadString()}}U=new WeakMap,z=new WeakMap,H=new WeakMap;class gt{static GetIconForModelType(e){switch(e){case d.ModelType.Entity:return t.Icons.Filled.TableChart;case d.ModelType.Service:return t.Icons.Filled.Settings;case d.ModelType.View:return t.Icons.Filled.Wysiwyg;case d.ModelType.Report:return t.Icons.Filled.PieChart;case d.ModelType.Enum:return t.Icons.Filled.ViewList;case d.ModelType.Permission:return t.Icons.Filled.Lock;default:return t.Icons.Filled.TableChart}}}function $e(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)&&"$meta_AppBoxDesign_IModelDesigner"in l.constructor}var q;class F{constructor(){c(this,q,void 0);o(this,"Label",t.State.op_Implicit_From("None"));o(this,"Designer")}get Children(){return null}get Id(){return h(this,q)}set Id(e){m(this,q,e)}toString(){return this.Label.Value}ReadFrom(e){this.Id=e.ReadString(),this.Label.Value=e.ReadString()}}q=new WeakMap;class yt extends F{constructor(){super(...arguments);o(this,"_children",new u.List)}get Type(){return p.DataStoreRootNode}get Children(){return this._children}ReadFrom(e){super.ReadFrom(e);let i=e.ReadVariant();for(let n=0;n<i;n++){let r=new N;r.ReadFrom(e),this._children.Add(r)}}}const Ae=class extends F{get Type(){return p.DataStoreNode}};let N=Ae;o(N,"None",new Ae);class St extends F{constructor(){super(...arguments);o(this,"_children",new u.List)}get Type(){return p.ApplicationRoot}get Children(){return this._children}ReadFrom(e){super.ReadFrom(e);let i=e.ReadVariant();for(let n=0;n<i;n++){let r=new Ft;r.ReadFrom(e),this._children.Add(r)}}}class Ft extends F{constructor(){super(...arguments);o(this,"_children",new u.List)}get Type(){return p.ApplicationNode}get Children(){return this._children}ReadFrom(e){super.ReadFrom(e);let i=e.ReadVariant();for(let n=0;n<i;n++){let r=new ft(this);r.ReadFrom(e),this._children.Add(r)}}}class ft extends F{constructor(e){super();o(this,"ApplicationNode");o(this,"_children",new u.List);this.ApplicationNode=e}get Type(){return p.ModelRootNode}get Children(){return this._children}ReadFrom(e){super.ReadFrom(e);let i=e.ReadVariant();for(let n=0;n<i;n++){let r=e.ReadByte(),s;if(r==p.ModelNode)s=new de(this);else if(r==p.FolderNode)s=new we(this);else throw new u.NotSupportedException;s.ReadFrom(e),this._children.Add(s)}}}class we extends F{constructor(e){super();o(this,"ModelRootNode");o(this,"_children",new u.List);this.ModelRootNode=e}get Type(){return p.FolderNode}get Children(){return this._children}ReadFrom(e){super.ReadFrom(e);let i=e.ReadVariant();for(let n=0;n<i;n++){let r=e.ReadByte(),s;if(r==p.ModelNode)s=new de(this.ModelRootNode);else if(r==p.FolderNode)s=new we(this.ModelRootNode);else throw new u.NotSupportedException;s.ReadFrom(e),this._children.Add(s)}}}var j;class de extends F{constructor(e){super();o(this,"ModelRootNode");c(this,j,0);this.ModelRootNode=e}get AppName(){return this.ModelRootNode.ApplicationNode.Label.Value}get Type(){return p.ModelNode}get ModelType(){return h(this,j)}set ModelType(e){m(this,j,e)}ReadFrom(e){super.ReadFrom(e),this.ModelType=e.ReadByte()}}j=new WeakMap;class Tt{constructor(){o(this,"RootNodes",new u.List)}WriteTo(e){throw new u.NotSupportedException}ReadFrom(e){let i=e.ReadVariant();for(let n=0;n<i;n++){let r=e.ReadByte(),s;if(r==p.DataStoreRootNode)s=new yt;else if(r==p.ApplicationRoot)s=new St;else throw new u.NotSupportedException;s.ReadFrom(e),this.RootNodes.Add(s)}}}var J,Q,X,Y;class Mt{constructor(){c(this,J,0);c(this,Q,"");c(this,X,void 0);c(this,Y,void 0)}get Kind(){return h(this,J)}set Kind(e){m(this,J,e)}get Label(){return h(this,Q)}set Label(e){m(this,Q,e)}get InsertText(){return h(this,X)}set InsertText(e){m(this,X,e)}get Detail(){return h(this,Y)}set Detail(e){m(this,Y,e)}WriteTo(e){throw new u.NotSupportedException}ReadFrom(e){this.Kind=e.ReadByte(),this.Label=e.ReadString(),this.InsertText=e.ReadString(),this.Detail=e.ReadString()}}J=new WeakMap,Q=new WeakMap,X=new WeakMap,Y=new WeakMap;var Z,ee,te,ie,ne,oe;const me=class{constructor(){c(this,Z,0);c(this,ee,void 0);c(this,te,void 0);c(this,ie,void 0);c(this,ne,0);c(this,oe,void 0)}get ParentNodeType(){return h(this,Z)}set ParentNodeType(e){m(this,Z,e)}get ParentNodeId(){return h(this,ee)}set ParentNodeId(e){m(this,ee,e)}get NewNode(){return h(this,te)}set NewNode(e){m(this,te,e)}get RootNodeId(){return h(this,ie)}set RootNodeId(e){m(this,ie,e)}get InsertIndex(){return h(this,ne)}set InsertIndex(e){m(this,ne,e)}get ParentNode(){return h(this,oe)}set ParentNode(e){m(this,oe,e)}WriteTo(e){throw new u.NotSupportedException}ReadFrom(e){switch(this.ParentNodeType=e.ReadByte(),this.ParentNodeId=e.ReadString(),this.RootNodeId=e.ReadString(),this.InsertIndex=e.ReadInt(),this.ParentNode=a.TreeController.FindNode(n=>n.Type==this.ParentNodeType&&n.Id==this.ParentNodeId),e.ReadByte()){case p.FolderNode:this.NewNode=new we(me.GetModelRootNode(this.ParentNode));break;case p.ModelNode:this.NewNode=new de(me.GetModelRootNode(this.ParentNode));break;case p.DataStoreNode:this.NewNode=new N;break;default:throw new u.NotSupportedException}this.NewNode.ReadFrom(e)}static GetModelRootNode(e){switch(e.Data.Type){case p.ModelRootNode:return e.Data;case p.FolderNode:return e.Data.ModelRootNode;default:throw new u.NotSupportedException}}};let Ue=me;Z=new WeakMap,ee=new WeakMap,te=new WeakMap,ie=new WeakMap,ne=new WeakMap,oe=new WeakMap;const Be=class{get TriggerCharacters(){return[46]}async ProvideCompletionItems(e,i,n){let r=await I.Channel.Invoke("sys.DesignService.GetCompletion",[0,e.Tag,i,n]);return r??null}};let he=Be;o(he,"Default",new Be);class Ge extends t.Dialog{constructor(e){super();o(this,"_name",t.State.op_Implicit_From(""));o(this,"_type");this.Width=t.State.op_Implicit_From(300),this.Height=t.State.op_Implicit_From(180),this.Title.Value=`New ${e}`,this._type=e}BuildBody(){return new t.Container().Init({Padding:t.State.op_Implicit_From(t.EdgeInsets.All(20)),Child:new t.Input(this._name).Init({HintText:"Please input name"})})}OnClosing(e){return!e&&!u.IsNullOrEmpty(this._name.Value)&&this.CreateAsync(),super.OnClosing(e)}async CreateAsync(){let e=a.TreeController.FirstSelectedNode;if(e==null)return;let i=`sys.DesignService.New${this._type}`;this._type!="Application"&&this._type!="Folder"&&(i+="Model");let n=this._type=="Application"?[this._name.Value]:[Math.floor(e.Data.Type)&4294967295,e.Data.Id,this._name.Value],r=await I.Channel.Invoke(i,n);a.OnNewNode(r)}}class Ne extends t.Dialog{constructor(){super();o(this,"_name",t.State.op_Implicit_From(""));o(this,"_store",new t.Rx(null));this.Width=t.State.op_Implicit_From(300),this.Height=t.State.op_Implicit_From(210),this.Title.Value="New Entity"}BuildBody(){return new t.Container().Init({Padding:t.State.op_Implicit_From(t.EdgeInsets.All(20)),Child:new t.Column().Init({Children:[new t.Form().Init({LabelWidth:80,Children:[new t.FormItem("Name:",new t.Input(this._name)),new t.FormItem("DataStore:",new t.Select(this._store).Init({Options:Ne.GetAllDataStores()}))]})]})})}OnClosing(e){return!e&&!u.IsNullOrEmpty(this._name.Value)&&this.CreateAsync(),super.OnClosing(e)}async CreateAsync(){let e=a.TreeController.FirstSelectedNode;if(e==null)return;let i=[Math.floor(e.Data.Type)&4294967295,e.Data.Id,this._name.Value,this._store.Value==null?null:this._store.Value.Id],n=await I.Channel.Invoke("sys.DesignService.NewEntityModel",i);a.OnNewNode(n)}static GetAllDataStores(){let e=a.TreeController.DataSource[0],i=new Array(e.Children.length+1);i[0]=N.None;for(let n=1;n<i.length;n++)i[n]=e.Children[n-1];return i}}class Re extends t.Dialog{constructor(){super();o(this,"_dataGridController",new t.DataGridController);this.Width=t.State.op_Implicit_From(400),this.Height=t.State.op_Implicit_From(300),this.Title.Value="Publish"}BuildBody(){return new t.Container().Init({Padding:t.State.op_Implicit_From(t.EdgeInsets.All(20)),Child:new t.DataGrid(this._dataGridController).Init({Columns:[new t.DataGridTextColumn("ModelType",e=>e.ModelType),new t.DataGridTextColumn("ModelId",e=>e.ModelId)]})})}OnMounted(){super.OnMounted(),this.LoadChanges()}async LoadChanges(){try{let e=await I.Channel.Invoke("sys.DesignService.GetPendingChanges");e!=null&&(this._dataGridController.DataSource=new u.List(e))}catch(e){t.Notification.Error(`\u52A0\u8F7D\u6A21\u578B\u53D8\u66F4\u5931\u8D25:${e.Message}`)}}OnClosing(e){return e||Re.PublishAsync(),super.OnClosing(e)}static async PublishAsync(){try{await I.Channel.Invoke("sys.DesignService.Publish",["commit message"]),t.Notification.Success("\u53D1\u5E03\u6210\u529F")}catch(e){t.Notification.Error(`\u53D1\u5E03\u5931\u8D25: ${e.Message}`)}}}class ze extends t.Dialog{constructor(e,i,n,r){super();o(this,"_referenceType");o(this,"_modelId");o(this,"_target");o(this,"_oldName");o(this,"_newName",t.State.op_Implicit_From(""));this._referenceType=e,this._target=t.State.op_Implicit_From(i),this._modelId=n,this._oldName=t.State.op_Implicit_From(r),this.Title.Value=this.GetTitile(),this.Width=t.State.op_Implicit_From(380),this.Height=t.State.op_Implicit_From(240)}GetTitile(){switch(this._referenceType){case d.ModelReferenceType.EntityModel:return"Rename Entity";case d.ModelReferenceType.EntityMember:return"Rename Entity Member";case d.ModelReferenceType.ServiceModel:return"Rename Service";case d.ModelReferenceType.ViewModel:return"Rename View";default:return"Rename"}}GetNewName(){return this._newName.Value}BuildBody(){return new t.Container().Init({Padding:t.State.op_Implicit_From(t.EdgeInsets.All(20)),Child:new t.Form().Init({LabelWidth:100,Children:[new t.FormItem("Target:",new t.Input(this._target).Init({Readonly:t.State.op_Implicit_From(!0)})),new t.FormItem("Old Name:",new t.Input(this._oldName).Init({Readonly:t.State.op_Implicit_From(!0)})),new t.FormItem("New Name:",new t.Input(this._newName))]})})}OnClosing(e){return e||this.RenameAsync(),super.OnClosing(e)}async RenameAsync(){try{let e=await I.Channel.Invoke("sys.DesignService.Rename",[Math.floor(this._referenceType)&4294967295,this._modelId,this._oldName.Value,this._newName.Value]);a.OnRenameDone(this._referenceType,this._modelId,e),t.Notification.Success("\u91CD\u547D\u540D\u6210\u529F")}catch(e){t.Notification.Error(`\u91CD\u547D\u540D\u5931\u8D25: ${e.Message}`)}}}const f=class{static async Checkout(){let e=a.TreeController.FirstSelectedNode;if(e==null){t.Notification.Error("\u8BF7\u5148\u9009\u62E9\u5F85\u7B7E\u51FA\u8282\u70B9");return}let i=e.Data.Type;if(i!=p.ModelNode&&i!=p.ModelRootNode&&i!=p.DataStoreNode){t.Notification.Error("\u65E0\u6CD5\u7B7E\u51FA\u8BE5\u7C7B\u578B\u8282\u70B9");return}try{await I.Channel.Invoke("sys.DesignService.CheckoutNode",[Math.floor(i)&4294967295,e.Data.Id]),t.Notification.Success(`\u7B7E\u51FA\u8282\u70B9[${e.Data.Label}]\u6210\u529F`)}catch(n){t.Notification.Success(`\u7B7E\u51FA\u8282\u70B9[${e.Data.Label}]\u5931\u8D25: ${n.Message}`)}}static async Save(){let e=a.ActiveDesigner;if(e!=null)try{await e.SaveAsync(),t.Notification.Success("\u4FDD\u5B58\u6210\u529F")}catch(i){t.Notification.Error(`\u4FDD\u5B58\u5931\u8D25: ${i.Message}`)}}static async Delete(){let e=a.TreeController.FirstSelectedNode;if(e==null){t.Notification.Error("\u8BF7\u5148\u9009\u62E9\u5F85\u5220\u9664\u7684\u8282\u70B9");return}let i=e.Data.Type;try{let n=await I.Channel.Invoke("sys.DesignService.DeleteNode",[Math.floor(i)&4294967295,e.Data.Id]);a.OnDeleteNode(e,n),t.Notification.Success(`\u5220\u9664\u8282\u70B9[${e.Data.Label}]\u6210\u529F`)}catch(n){t.Notification.Error(`\u5220\u9664\u8282\u70B9[${e.Data.Label}]\u5931\u8D25: ${n.Message}`)}}static async Rename(){let e=a.TreeController.FirstSelectedNode;if(e==null){t.Notification.Error("\u8BF7\u5148\u9009\u62E9\u5F85\u91CD\u547D\u540D\u7684\u8282\u70B9");return}let i=0,n;if(e.Data.Type==p.ModelNode)switch(n=e.Data,n.ModelType){case d.ModelType.Entity:i=d.ModelReferenceType.EntityModel;break;case d.ModelType.Service:i=d.ModelReferenceType.ServiceModel;break;case d.ModelType.View:i=d.ModelReferenceType.ViewModel;break;default:t.Notification.Error("\u4E0D\u652F\u6301\u91CD\u547D\u540D\u7684\u8282\u70B9");return}else{t.Notification.Error("\u4E0D\u652F\u6301\u91CD\u547D\u540D\u7684\u8282\u70B9");return}let r=new ze(i,n.Label.Value,n.Id,n.Label.Value);await r.ShowAndWaitClose()||(n.Label.Value=r.GetNewName())}};let C=f;o(C,"NewEntityCommand",()=>new Ne().Show()),o(C,"NewServiceCommand",()=>new Ge("Service").Show()),o(C,"NewViewCommand",()=>new Ge("View").Show()),o(C,"CheckoutCommand",f.Checkout),o(C,"SaveCommand",f.Save),o(C,"RenameCommand",f.Rename),o(C,"DeleteCommand",f.Delete),o(C,"PublishCommand",()=>new Re().Show()),o(C,"NotImplCommand",()=>t.Notification.Error("\u6682\u672A\u5B9E\u73B0"));class De extends t.View{constructor(){super();o(this,"_bgColor",new t.Color(43,49,56));this.Child=new t.Container().Init({Height:t.State.op_Implicit_From(45),BgColor:t.State.op_Implicit_From(this._bgColor),Child:new t.Row().Init({Children:[new t.Container().Init({Width:t.State.op_Implicit_From(50)}),new t.Expanded().Init({Child:new t.MainMenu(De.BuildMenuItems()).Init({BackgroudColor:this._bgColor,Color:t.Colors.White})})]})})}static BuildMenuItems(){return[t.MenuItem.SubMenu("DataStore",t.Icons.Filled.Dns,[t.MenuItem.Item("Add DataStore",null,C.NotImplCommand),t.MenuItem.Item("Remove DataStore",null,C.NotImplCommand)]),t.MenuItem.SubMenu("New",t.Icons.Filled.CreateNewFolder,[t.MenuItem.Item("Application",t.Icons.Filled.Widgets,C.NotImplCommand),t.MenuItem.Item("Folder",t.Icons.Filled.Folder,C.NotImplCommand),t.MenuItem.Item("Entity",t.Icons.Filled.TableChart,C.NewEntityCommand),t.MenuItem.Item("Service",t.Icons.Filled.Settings,C.NewServiceCommand),t.MenuItem.Item("View",t.Icons.Filled.Wysiwyg,C.NewViewCommand),t.MenuItem.Item("Report",t.Icons.Filled.PieChart,C.NotImplCommand),t.MenuItem.Item("Enum",t.Icons.Filled.ViewList,C.NotImplCommand),t.MenuItem.Item("Permission",t.Icons.Filled.Lock,C.NotImplCommand)]),t.MenuItem.SubMenu("Models",t.Icons.Filled.Widgets,[t.MenuItem.Item("Save",t.Icons.Filled.Save,C.SaveCommand),t.MenuItem.Item("Checkout",t.Icons.Filled.CheckCircle,C.CheckoutCommand),t.MenuItem.Item("Rename",t.Icons.Filled.DriveFileRenameOutline,C.RenameCommand),t.MenuItem.Item("Delete",t.Icons.Filled.DeleteForever,C.DeleteCommand),t.MenuItem.Item("Publish",t.Icons.Filled.Publish,C.PublishCommand)]),t.MenuItem.Item("Tools",t.Icons.Filled.Handyman),t.MenuItem.Item("AppStore",t.Icons.Filled.Store),t.MenuItem.Item("About",t.Icons.Filled.Help)]}}class Nt extends t.View{constructor(){super();this.Child=new t.Container().Init({Height:t.State.op_Implicit_From(25),BgColor:t.State.op_Implicit_From(new t.Color(4291585338)),Child:new t.Center().Init({Child:new t.Text(t.State.op_Implicit_From("enjoycode@icloud.com")).Init({TextColor:t.State.op_Implicit_From(t.Colors.White)})})})}}var He=(l=>(l[l.DesignTree=0]="DesignTree",l[l.Outline=1]="Outline",l[l.Toolbox=2]="Toolbox",l[l.Settings=3]="Settings",l))(He||{});class Rt extends t.View{constructor(){super();o(this,"_buttonColor",t.State.op_Implicit_From(t.Colors.White));o(this,"_buttonSize",t.State.op_Implicit_From(25));this.Child=new t.Container().Init({Padding:t.State.op_Implicit_From(t.EdgeInsets.Only(5,0,0,0)),Width:t.State.op_Implicit_From(45),BgColor:t.State.op_Implicit_From(new t.Color(43,49,56)),Child:new t.Column().Init({Children:[new t.Expanded().Init({Child:new t.Column(t.HorizontalAlignment.Center,5).Init({Children:[this.BuildButton(t.Icons.Filled.Folder,0),this.BuildButton(t.Icons.Filled.AccountTree,1),this.BuildButton(t.Icons.Filled.Build,2),this.BuildButton(t.Icons.Filled.Settings,3)]})}),this.BuildButton(t.Icons.Filled.ArrowLeft)]})})}BuildButton(e,i=null){let n=this._buttonColor;return i!=null&&(n=this.Compute1(a.ActiveSidePad,r=>r==i?new t.Color(4283090410):new t.Color(4285167493))),new t.Button(null,t.State.op_Implicit_From(e)).Init({FontSize:this._buttonSize,TextColor:n,Style:t.ButtonStyle.Transparent,OnTap:r=>this.OnClick(i)})}OnClick(e){e!=null&&(a.ActiveSidePad.Value=e)}}class Dt extends t.View{constructor(){super();this.Child=new t.Row().Init({Children:[new Rt,new t.Container().Init({DebugLabel:"SidePad",Padding:t.State.op_Implicit_From(t.EdgeInsets.All(5)),Width:t.State.op_Implicit_From(250),BgColor:t.State.op_Implicit_From(new t.Color(4294177779)),Child:new t.Conditional(a.ActiveSidePad).When(e=>e==0,()=>new _e).When(e=>e==1,()=>new Et).When(e=>e==2,()=>new bt).When(e=>e==3,()=>new xt)})]})}}class _e extends t.View{constructor(){super();o(this,"_searchKey",t.State.op_Implicit_From(""));o(this,"_hasLoadTree",!1);this.Child=new t.Column().Init({Children:[new t.Input(this._searchKey).Init({Prefix:new t.Icon(t.State.op_Implicit_From(t.Icons.Filled.Search))}),new t.TreeView(a.TreeController)]})}static BuildTreeNode(e,i){i.Icon=new t.Icon(t.State.op_Implicit_From(_e.GetIconForNode(e))),i.Label=new t.Text(e.Label),i.IsLeaf=e.Type==p.ModelNode||e.Type==p.DataStoreNode,i.IsExpanded=e.Type==p.DataStoreRootNode||e.Type==p.ApplicationRoot||e.Type==p.ApplicationNode}static GetIconForNode(e){switch(e.Type){case p.DataStoreNode:return t.Icons.Filled.Storage;case p.ApplicationNode:return t.Icons.Filled.Widgets;case p.ModelNode:return gt.GetIconForModelType(e.ModelType);default:return t.Icons.Filled.Folder}}OnMounted(){super.OnMounted(),this.LoadDesignTree()}async LoadDesignTree(){if(!this._hasLoadTree){this._hasLoadTree=!0,a.TreeController.IsLoading=!0;try{let e=await I.Channel.Invoke("sys.DesignService.LoadDesignTree");a.TreeController.DataSource=e.RootNodes}catch(e){t.Notification.Error(`Can't load design tree: ${e.Message}`)}finally{a.TreeController.IsLoading=!1}}}}class Et extends t.View{constructor(){super();o(this,"NotSupported",new t.Center().Init({Child:new t.Text(t.State.op_Implicit_From("Not supported."))}));a.DesignerController.TabSelectChanged.Add(this.OnActiveDesignerChanged,this),this.Child=this.NotSupported}OnMounted(){this.BuildOutlineView()}OnActiveDesignerChanged(e){!this.IsMounted||this.BuildOutlineView()}BuildOutlineView(){let e=a.ActiveDesigner;if($e(e)){let n=e.GetOutlinePad();if(n!=null){this.Child=n,this.Invalidate(t.InvalidAction.Relayout);return}}this.Child!==this.NotSupported&&(this.Child=this.NotSupported,this.Invalidate(t.InvalidAction.Relayout))}}class bt extends t.View{constructor(){super();this.Child=new t.Text(t.State.op_Implicit_From("Toolbox"))}}class xt extends t.View{constructor(){super();this.Child=new t.Text(t.State.op_Implicit_From("Settings"))}}class ce extends t.View{constructor(){super();this.Child=new t.Container().Init({Height:t.State.op_Implicit_From(190),Child:new t.TabView(a.BottomPadController,ce.BuildTab,ce.BuildBody,!1,40).Init({SelectedTabColor:t.Colors.White,TabBarBgColor:new t.Color(4294177779)})})}static BuildTab(e,i){let n=t.RxComputed.Make1(i,r=>r?t.Theme.FocusedColor:t.Colors.Black);return new t.Text(t.State.op_Implicit_From(e)).Init({TextColor:n})}static BuildBody(e){return e=="Problems"?new t.DataGrid(a.ProblemsController).Init({Columns:[new t.DataGridTextColumn("Position",i=>i.Position).Init({Width:t.ColumnWidth.Fixed(180)}),new t.DataGridTextColumn("Message",i=>i.Message)]}):e=="Usages"?new t.DataGrid(a.UsagesController).Init({Columns:[new t.DataGridTextColumn("Model",i=>i.ModelName),new t.DataGridTextColumn("Location",i=>i.Location)]}):new t.Container().Init({Padding:t.State.op_Implicit_From(t.EdgeInsets.All(10)),BgColor:t.State.op_Implicit_From(t.Colors.White),Child:new t.Text(t.State.op_Implicit_From(e))})}}class M extends t.View{constructor(){super();o(this,"_isOpenedAnyDesigner",t.State.op_Implicit_From(!1));a.TreeController.SelectionChanged.Add(M.OnTreeSelectionChanged),a.DesignerController.TabAdded.Add(this.OnDesignerOpened,this),a.DesignerController.TabClosed.Add(this.OnDesignerClosed,this),this.BgColor=t.State.op_Implicit_From(t.Colors.White),this.Child=new t.IfConditional(this._isOpenedAnyDesigner,()=>new t.TabView(a.DesignerController,M.BuildTab,M.BuildBody,!0,40).Init({SelectedTabColor:t.Colors.White,TabBarBgColor:new t.Color(4294177779)}),()=>new t.Center().Init({Child:new t.Text(t.State.op_Implicit_From("Welcome to AppBox!"))}))}static BuildTab(e,i){let n=t.RxComputed.Make1(i,r=>r?t.Theme.FocusedColor:t.Colors.Black);return new t.Text(e.Label).Init({TextColor:n})}static BuildBody(e){if(e.Type==p.ModelNode){let i=e;switch(i.ModelType){case d.ModelType.Entity:let n=new Je(i);return e.Designer=n,n;case d.ModelType.View:let r=new fe(i);return e.Designer=r,r;case d.ModelType.Service:let s=new Fe(i);return e.Designer=s,s}}return new t.Container().Init({Padding:t.State.op_Implicit_From(t.EdgeInsets.All(10)),BgColor:t.State.op_Implicit_From(t.Colors.White),Child:new t.Text(e.Label)})}OnDesignerOpened(e){this._isOpenedAnyDesigner.Value=a.DesignerController.Count>0}async OnDesignerClosed(e){if(this._isOpenedAnyDesigner.Value=a.DesignerController.Count>0,e.Designer=null,e.Type==p.ModelNode){let i=e;(i.ModelType==d.ModelType.Service||i.ModelType==d.ModelType.View)&&await I.Channel.Invoke("sys.DesignService.CloseDesigner",[Math.floor(e.Type)&4294967295,e.Id])}}static OnTreeSelectionChanged(){let e=a.TreeController.FirstSelectedNode;e!=null&&e.Data instanceof de&&a.OpenOrActiveDesigner(e.Data,null)}}const w=class{static get ActiveDesigner(){let e=w.DesignerController.SelectedIndex;return e<0?null:w.DesignerController.GetAt(e).Designer}static OnNewNode(e){let i=w.TreeController.InsertNode(e.NewNode,e.ParentNode,e.InsertIndex);w.TreeController.ExpandTo(i),w.TreeController.SelectNode(i)}static OnDeleteNode(e,i){w.DesignerController.Remove(e.Data),w.TreeController.RemoveNode(e)}static OnRenameDone(e,i,n){for(let r=0;r<w.DesignerController.Count;r++){let s=w.DesignerController.GetAt(r).Designer;if(s!=null&&$e(s)){const _=s;n.Contains(_.ModelNode.Id)&&s.RefreshAsync()}}}static UpdateProblems(e,i){w.ProblemsController.DataSource=i}static UpdateUsages(e){w.UsagesController.DataSource=e,w.BottomPadController.SelectAt(1)}static OpenOrActiveDesigner(e,i){let n=w.DesignerController.IndexOf(e);n<0?w.DesignerController.Add(e):w.DesignerController.SelectAt(n),i!=null&&e.Designer.GotoDefinition(i)}static FindDesignNodeById(e){return w.TreeController.FindNode(n=>n.Id==e)?.Data}static GetAllEntityNodes(){let e=new u.List,i=w.TreeController.DataSource[1];for(const n of i.Children){let r=n.Children[0];w.LoopAddEntityNode(r,e)}return e}static LoopAddEntityNode(e,i){if(e instanceof de){const n=e;i.Add(n)}else if(e.Children!=null)for(const n of e.Children)w.LoopAddEntityNode(n,i)}};let a=w;o(a,"ActiveSidePad",t.State.op_Implicit_From(He.DesignTree)),o(a,"TreeController",new t.TreeController(_e.BuildTreeNode,e=>e.Children)),o(a,"DesignerController",new t.TabController(new u.List)),o(a,"BottomPadController",new t.TabController(new u.List().Init(["Problems","Usages","Output"]))),o(a,"ProblemsController",new t.DataGridController),o(a,"UsagesController",new t.DataGridController);class Ee{constructor(){o(this,"Name");o(this,"Children");o(this,"ModelId");o(this,"OrgUnits")}ReadFrom(e){this.Name=e.ReadString();let i=e.ReadVariant();if(i>=0){this.Children=new Pe;for(let n=0;n<i;n++){let r=new Ee;r.ReadFrom(e),this.Children.Add(r)}}else{this.ModelId=e.ReadString(),i=e.ReadVariant(),this.OrgUnits=new Pe;for(let n=0;n<i;n++)this.OrgUnits.Add(e.ReadGuid())}}WriteTo(e){throw new Error("\u672A\u5B9E\u73B0")}}class Ot{static async TryInit(){if(g.GetSerializer(y.DesignTree)!=null)return;const e=window.TreeSitter;await e.init();let i=await e.Language.load("/tree-sitter-c_sharp.wasm");ot.Init(i),g.RegisterKnownType(y.EntityModelVO,!1,()=>new It),g.RegisterKnownType(y.EntityFieldVO,!1,()=>new ke),g.RegisterKnownType(y.EntityRefVO,!1,()=>new Me),g.RegisterKnownType(y.EntitySetVO,!1,()=>new Ke),g.RegisterKnownType(y.EntityMemberInfo,!1,()=>new Ct),g.RegisterKnownType(y.DesignTree,!1,()=>new Tt),g.RegisterKnownType(y.NewNodeResult,!1,()=>new Ue),g.RegisterKnownType(y.CodeProblem,!0,()=>new ht),g.RegisterKnownType(y.CompletionItem,!0,()=>new Mt),g.RegisterKnownType(y.ChangedModel,!0,()=>new ut),g.RegisterKnownType(y.FieldWithOrder,!0,()=>new nt),g.RegisterKnownType(y.ReferenceVO,!1,()=>new wt),g.RegisterKnownType(y.TextChange,!0,()=>new _t),g.RegisterKnownType(y.PermissionNode,!1,()=>new Ee)}}const ve=class{async Execute(e){let i=e.Document.Tag,n=await I.Channel.Invoke("sys.DesignService.FormatDocument",[i]);if(!(n==null||n.length==0)){e.Document.StartUndoGroup();for(const r of n)e.Document.Replace(r.Offset,r.Length,r.Text??"");e.Document.EndUndoGroup()}}};let ye=ve;o(ye,"Default",new ve);const Le=class{async Execute(e){let i=e.Document.Tag,n=e.Caret.Line,r=e.Caret.Column,s=await I.Channel.Invoke("sys.DesignService.GotoDefinition",[i,n,r]);if(s==null)return;let _=a.FindDesignNodeById(s.ModelId);_!=null&&a.OpenOrActiveDesigner(_,s)}static RunOnCodeEditor(e,i){let n=e.Document,r=n.OffsetToPosition(i.Offset),s=n.OffsetToPosition(i.Offset+i.Length);e.SetCaret(r.Line,r.Column),e.SetSelection(r.Clone(),s.Clone())}};let S=Le;o(S,"Default",new Le);class qe{static BuildContextMenu(e){return[t.MenuItem.Item("Goto Definition",null,()=>S.Default.Execute(e)),t.MenuItem.Divider(),t.MenuItem.Item("Format Document",null,()=>ye.Default.Execute(e))]}}class je{constructor(e,i){o(this,"_targetType");o(this,"_targetId");o(this,"_submittingFlag",0);o(this,"_queue",new u.List);this._targetType=e,this._targetId=i}OnDocumentChanged(e){this._queue.Add(new At(e.Offset,e.Length,e.Text)),this.StartSubmit()}async StartSubmit(){if(this._submittingFlag==0){for(this._submittingFlag=1;this._queue.length>0;){let e=this._queue[0];await I.Channel.Invoke("sys.DesignService.ChangeBuffer",[this._targetType,this._targetId,e.Offset,e.Length,e.Text]),this._queue.RemoveAt(0)}this._submittingFlag=0}}}class At{constructor(e,i,n){o(this,"Offset");o(this,"Length");o(this,"Text");this.Offset=e,this.Length=i,this.Text=n}}const T=class extends t.Dialog{constructor(e){super();o(this,"_modelNode");o(this,"_name",t.State.op_Implicit_From(""));o(this,"_allowNull",t.State.op_Implicit_From(!1));o(this,"_memberType",t.State.op_Implicit_From(T.MemberTypes[0]));o(this,"_fieldType",t.State.op_Implicit_From(T.FieldTypes[0]));o(this,"_entityRefTarget",new t.Rx(null));o(this,"_entitySetTarget",new t.Rx(null));this._modelNode=e,this.Width=t.State.op_Implicit_From(380),this.Height=t.State.op_Implicit_From(280),this.Title.Value="New Entity Member"}BuildBody(){return new t.Container().Init({Padding:t.State.op_Implicit_From(t.EdgeInsets.All(20)),Child:new t.Column().Init({Children:[new t.Form().Init({LabelWidth:100,Padding:t.EdgeInsets.Only(5,5,5,0),Children:[new t.FormItem("Name:",new t.Input(this._name)),new t.FormItem("MemberType:",new t.Select(this._memberType).Init({Options:T.MemberTypes}))]}),new t.Conditional(this._memberType).When(e=>e=="EntityField",()=>new t.Form().Init({LabelWidth:100,Padding:t.EdgeInsets.Only(5,0,5,5),Children:[new t.FormItem("FieldType:",new t.Select(this._fieldType).Init({Options:T.FieldTypes})),new t.FormItem("AllowNull:",new t.Checkbox(this._allowNull))]})).When(e=>e=="EntityRef",()=>new t.Form().Init({LabelWidth:100,Padding:t.EdgeInsets.Only(5,0,5,5),Children:[new t.FormItem("Target:",new t.Select(this._entityRefTarget).Init({Options:a.GetAllEntityNodes().ToArray()})),new t.FormItem("AllowNull:",new t.Checkbox(this._allowNull))]})).When(e=>e=="EntitySet",()=>new t.Form().Init({LabelWidth:100,Padding:t.EdgeInsets.Only(5,0,5,5),Children:[new t.FormItem("Target:",new t.Select(this._entitySetTarget).Init({OptionsAsyncGetter:I.Channel.Invoke("sys.DesignService.GetAllEntityRefs",[this._modelNode.Id])}))]}))]})})}GetMemberTypeValue(){switch(this._memberType.Value){case"EntityField":return d.EntityMemberType.EntityField;case"EntityRef":return d.EntityMemberType.EntityRef;case"EntitySet":return d.EntityMemberType.EntitySet;default:throw new u.Exception}}GetFieldTypeValue(){switch(this._fieldType.Value){case"String":return d.EntityFieldType.String;case"Int":return d.EntityFieldType.Int;case"Long":return d.EntityFieldType.Long;case"Float":return d.EntityFieldType.Float;case"Double":return d.EntityFieldType.Double;default:throw new u.NotImplementedException}}GetRefModelIds(){return this._entityRefTarget.Value==null?[]:[this._entityRefTarget.Value.Id]}GetArgs(){let e=this.GetMemberTypeValue();if(e==d.EntityMemberType.EntityField)return[this._modelNode.Id,this._name.Value,e,this.GetFieldTypeValue(),this._allowNull.Value];if(e==d.EntityMemberType.EntityRef)return[this._modelNode.Id,this._name.Value,e,this.GetRefModelIds(),this._allowNull.Value];if(e==d.EntityMemberType.EntitySet)return[this._modelNode.Id,this._name.Value,e,this._entitySetTarget.Value.ModelId,this._entitySetTarget.Value.MemberId];throw new u.NotImplementedException}};let ae=T;o(ae,"MemberTypes",["EntityField","EntityRef","EntitySet"]),o(ae,"FieldTypes",["String","Int","Long","Float","Double"]);class Bt extends t.Dialog{constructor(e){super();o(this,"_entityModel");o(this,"_selected",new t.Rx(null));o(this,"_orderByDesc",t.State.op_Implicit_From(!1));this._entityModel=e,this.Width=t.State.op_Implicit_From(380),this.Height=t.State.op_Implicit_From(200),this.Title.Value="EntityFieldWithOrder"}BuildBody(){return new t.Container().Init({Padding:t.State.op_Implicit_From(t.EdgeInsets.All(20)),Child:new t.Form().Init({Children:[new t.FormItem("EntityField:",new t.Select(this._selected).Init({Options:this._entityModel.Members.Where(e=>e.Type==d.EntityMemberType.EntityField).ToArray()})),new t.FormItem("OrderByDesc:",new t.Checkbox(this._orderByDesc))]})})}GetResult(){return this._selected.Value==null?null:new d.FieldWithOrder(this._selected.Value.Id,this._orderByDesc.Value)}}class vt extends t.RxObject{constructor(e){super();o(this,"Name");o(this,"FieldType");o(this,"Comment");this._target=e,this.Name=new t.RxProperty(()=>this.Target.Name),this.FieldType=new t.RxProperty(()=>this.Target.FieldType),this.Comment=new t.RxProperty(()=>this.Target.Comment??"",i=>this.Target.Comment=i)}}const pe=class extends t.View{constructor(e,i){super();o(this,"_entityModel");o(this,"_selectedMember");o(this,"_rxEntityField");this._entityModel=e,this._selectedMember=this.Bind(i,t.BindingOptions.None),this._rxEntityField=new vt(this._selectedMember.Value);let n=this._selectedMember.AsStateOfBool(r=>r!=null&&r.Type==d.EntityMemberType.EntityField);this.Child=new t.Column(t.HorizontalAlignment.Left).Init({Children:[new t.Text(t.State.op_Implicit_From("Entity Properties:")).Init({FontWeight:t.State.op_Implicit_From(CanvasKit.FontWeight.Bold)}),new t.Form().Init({LabelWidth:pe._labelWidth,Children:[new t.FormItem("DataStoreKind:",new t.Input(t.State.op_Implicit_From("SqlStore")).Init({Readonly:t.State.op_Implicit_From(!0)})),new t.FormItem("DataStoreName:",new t.Input(t.State.op_Implicit_From("Default")).Init({Readonly:t.State.op_Implicit_From(!0)})),new t.FormItem("Comment:",new t.Input(t.State.op_Implicit_From("")))]}),new t.IfConditional(n,()=>new t.Text(t.State.op_Implicit_From("EntityField Properties:")).Init({FontWeight:t.State.op_Implicit_From(CanvasKit.FontWeight.Bold)})),new t.IfConditional(n,()=>new t.Form().Init({LabelWidth:pe._labelWidth,Children:[new t.FormItem("Name:",new t.Input(this._rxEntityField.Name)),new t.FormItem("FieldType:",new t.Input(this._rxEntityField.FieldType.AsStateOfString(r=>d.EntityFieldType[r]))),new t.FormItem("Comment:",new t.Input(this._rxEntityField.Comment))]}))]})}OnStateChanged(e,i){if(e===this._selectedMember){this._selectedMember.Value!=null&&this._selectedMember.Value.Type==d.EntityMemberType.EntityField&&(this._rxEntityField.Target=this._selectedMember.Value);return}super.OnStateChanged(e,i)}};let Se=pe;o(Se,"_labelWidth",120);class be extends t.View{constructor(e,i,n){super();this.Child=new t.Row().Init({Children:[new t.Expanded().Init({Child:new t.DataGrid(i).Init({Columns:[new t.DataGridTextColumn("Name",r=>r.Name).Init({Width:t.ColumnWidth.Fixed(150)}),new t.DataGridTextColumn("Type",be.MemberTypeToString).Init({Width:t.ColumnWidth.Fixed(200)}),new t.DataGridCheckboxColumn("AllowNull",r=>r.AllowNull).Init({Width:t.ColumnWidth.Fixed(90)}),new t.DataGridTextColumn("Comment",r=>r.Comment??"")]})}),new t.Container().Init({BgColor:t.State.op_Implicit_From(new t.Color(4294177779)),Width:t.State.op_Implicit_From(280),Child:new Se(e,n)})]})}static MemberTypeToString(e){return e.Type==d.EntityMemberType.EntityField?`${d.EntityMemberType[e.Type]} - ${d.EntityFieldType[e.FieldType]}`:d.EntityMemberType[e.Type]}}class Lt extends t.View{constructor(e,i){super();o(this,"_entityModel");o(this,"_modelId");o(this,"_pkController",new t.DataGridController);o(this,"_idxController",new t.DataGridController);this._entityModel=e,this._modelId=i,this._pkController.DataSource=this._entityModel.SqlStoreOptions.PrimaryKeys,this._idxController.DataSource=this._entityModel.SqlStoreOptions.Indexes,this.Child=new t.Container().Init({Padding:t.State.op_Implicit_From(t.EdgeInsets.All(8)),Child:new t.Row(t.VerticalAlignment.Top,10).Init({Children:[new t.Expanded(this.BuildPrimaryKeysPannel()),new t.Expanded(this.BuildIndexesPannel())]})})}BuildPrimaryKeysPannel(){return new t.Card().Init({Padding:t.State.op_Implicit_From(t.EdgeInsets.All(10)),Child:new t.Column(t.HorizontalAlignment.Left,10).Init({Children:[new t.Text(t.State.op_Implicit_From("Primary Keys:")).Init({FontSize:t.State.op_Implicit_From(20),FontWeight:t.State.op_Implicit_From(CanvasKit.FontWeight.Bold)}),new t.ButtonGroup().Init({Children:[new t.Button(t.State.op_Implicit_From("Add"),t.State.op_Implicit_From(t.Icons.Filled.Add)).Init({OnTap:this.OnAddPk.bind(this)}),new t.Button(t.State.op_Implicit_From("Remove"),t.State.op_Implicit_From(t.Icons.Filled.Remove)).Init({OnTap:this.OnRemovePk.bind(this)})]}),new t.DataGrid(this._pkController).Init({Columns:[new t.DataGridTextColumn("Name",e=>this._entityModel.Members.First(i=>i.Id==e.MemberId).Name),new t.DataGridCheckboxColumn("OrderByDesc",e=>e.OrderByDesc)]})]})})}BuildIndexesPannel(){return new t.Card().Init({Padding:t.State.op_Implicit_From(t.EdgeInsets.All(10)),Child:new t.Column(t.HorizontalAlignment.Left,10).Init({Children:[new t.Text(t.State.op_Implicit_From("Indexes:")).Init({FontSize:t.State.op_Implicit_From(20),FontWeight:t.State.op_Implicit_From(CanvasKit.FontWeight.Bold)}),new t.ButtonGroup().Init({Children:[new t.Button(t.State.op_Implicit_From("Add"),t.State.op_Implicit_From(t.Icons.Filled.Add)),new t.Button(t.State.op_Implicit_From("Remove"),t.State.op_Implicit_From(t.Icons.Filled.Remove))]}),new t.DataGrid(this._idxController).Init({Columns:[new t.DataGridTextColumn("Name",e=>e.Name),new t.DataGridTextColumn("Fields",e=>this.GetIndexesFieldsList(e)),new t.DataGridCheckboxColumn("Unique",e=>!0)]})]})})}GetIndexesFieldsList(e){let i="";for(let n=0;n<e.Fields.length;n++)n!=0&&(i+=", "),i+=this._entityModel.Members.First(r=>r.Id==e.Fields[n].MemberId).Name,e.Fields[n].OrderByDesc&&(i+=" OrderByDesc");return i}async OnAddPk(e){let i=new Bt(this._entityModel);if(await i.ShowAndWaitClose())return;let r=i.GetResult();r!=null&&(this._pkController.Add(r.Clone()),this.ChangePrimaryKeys())}OnRemovePk(e){this._pkController.CurrentRowIndex<0||(this._pkController.RemoveAt(this._pkController.CurrentRowIndex),this.ChangePrimaryKeys())}async ChangePrimaryKeys(){let e=[this._modelId,this._entityModel.SqlStoreOptions.PrimaryKeys.length==0?null:this._entityModel.SqlStoreOptions.PrimaryKeys.ToArray()];try{await I.Channel.Invoke("sys.DesignService.ChangePrimaryKeys",e)}catch(i){t.Notification.Error(`Change primary keys error: ${i.Message}`)}}}var re;class Je extends t.View{constructor(e){super();c(this,re,void 0);o(this,"_activePad",t.State.op_Implicit_From(0));o(this,"_entityModel");o(this,"_pendingGoto");o(this,"_membersController",new t.DataGridController);o(this,"_selectedMember");this.ModelNode=e,this._selectedMember=this._membersController.ObserveCurrentRow(),this.Child=new t.Column().Init({Children:[this.BuildActionBar(),new t.Expanded().Init({Child:this.BuildBody()})]})}get ModelNode(){return h(this,re)}set ModelNode(e){m(this,re,e)}BuildActionBar(){return new t.Container().Init({BgColor:t.State.op_Implicit_From(new t.Color(4294309882)),Height:t.State.op_Implicit_From(45),Padding:t.State.op_Implicit_From(t.EdgeInsets.All(8)),Child:new t.Row(t.VerticalAlignment.Middle,10).Init({Children:[new t.ButtonGroup().Init({Children:[new t.Button(t.State.op_Implicit_From("Members")).Init({Width:t.State.op_Implicit_From(75),OnTap:e=>this._activePad.Value=0}),new t.Button(t.State.op_Implicit_From("Options")).Init({Width:t.State.op_Implicit_From(75),OnTap:e=>this._activePad.Value=1}),new t.Button(t.State.op_Implicit_From("Data")).Init({Width:t.State.op_Implicit_From(75)})]}),new t.IfConditional(this._activePad.AsStateOfBool(e=>e==0),()=>new t.ButtonGroup().Init({Children:[new t.Button(t.State.op_Implicit_From("Add"),t.State.op_Implicit_From(t.Icons.Filled.Add)).Init({OnTap:this.OnAddMember.bind(this)}),new t.Button(t.State.op_Implicit_From("Remove"),t.State.op_Implicit_From(t.Icons.Filled.Delete)).Init({OnTap:this.OnDeleteMember.bind(this)}),new t.Button(t.State.op_Implicit_From("Rename"),t.State.op_Implicit_From(t.Icons.Filled.Edit)).Init({OnTap:this.OnRenameMember.bind(this)}),new t.Button(t.State.op_Implicit_From("Usages"),t.State.op_Implicit_From(t.Icons.Filled.Link)).Init({OnTap:this.OnFindUsages.bind(this)})]}))]})})}BuildBody(){return new t.FutureBuilder(I.Channel.Invoke("sys.DesignService.OpenEntityModel",[this.ModelNode.Id]),(e,i)=>i!=null?(t.Notification.Error(`\u65E0\u6CD5\u52A0\u8F7D\u5B9E\u4F53\u6A21\u578B: ${i.Message}`),null):(this._entityModel=e,this._membersController.DataSource=this._entityModel.Members.Where(n=>!n.IsForeignKeyMember).ToList(),this._pendingGoto!=null&&(this.GotoDefinitionInternal(this._pendingGoto),this._pendingGoto=null),new t.Conditional(this._activePad).When(n=>n==0,()=>new be(this._entityModel,this._membersController,this._selectedMember)).When(n=>n==1,()=>new Lt(this._entityModel,this.ModelNode.Id))))}async OnAddMember(e){let i=new ae(this.ModelNode);if(!await i.ShowAndWaitClose())try{let r=await I.Channel.Invoke("sys.DesignService.NewEntityMember",i.GetArgs());for(const s of r){if(s.IsForeignKeyMember){this._entityModel.Members.Add(s);continue}this._membersController.Add(s)}}catch(r){t.Notification.Error(`\u65B0\u5EFA\u5B9E\u4F53\u6210\u5458\u9519\u8BEF: ${r.Message}`)}}async OnDeleteMember(e){if(this._selectedMember.Value==null)return;let i=[this.ModelNode.Id,this._selectedMember.Value.Name];try{await I.Channel.Invoke("sys.DesignService.DeleteEntityMember",i);let n=this._selectedMember.Value;if(n instanceof Me){const r=n;if(r.IsAggregationRef)throw new u.NotImplementedException;for(const s of r.FKMemberIds){let _=this._entityModel.Members.First(ge=>ge.Id==s);this._entityModel.Members.Remove(_)}}this._membersController.Remove(n)}catch(n){t.Notification.Error(`Delete member error: ${n.Message}`)}}async OnRenameMember(e){if(this._selectedMember.Value==null)return;let i=this._selectedMember.Value.Name,n=`${this.ModelNode.Label}.${i}`,r=new ze(d.ModelReferenceType.EntityMember,n,this.ModelNode.Id,i);await r.ShowAndWaitClose()||(this._selectedMember.Value.Name=r.GetNewName(),this._membersController.Refresh(),this._selectedMember.NotifyValueChanged())}async OnFindUsages(e){if(this._selectedMember.Value==null)return;let i=[d.ModelReferenceType.EntityMember,this.ModelNode.Id,this._selectedMember.Value.Name];try{let n=await I.Channel.Invoke("sys.DesignService.FindUsages",i);a.UpdateUsages(n)}catch(n){t.Notification.Error(`Delete member error: ${n.Message}`)}}GetOutlinePad(){return null}GotoDefinition(e){u.IsNullOrEmpty(e.Location)||(this._entityModel==null?this._pendingGoto=e:this.GotoDefinitionInternal(e))}GotoDefinitionInternal(e){let i=this._entityModel.Members.FirstOrDefault(n=>n.Name==e.Location);this._selectedMember.Value=i}SaveAsync(){return I.Channel.Invoke("sys.DesignService.SaveModel",[this.ModelNode.Id])}RefreshAsync(){return Promise.resolve()}}re=new WeakMap,o(Je,"$meta_AppBoxDesign_IModelDesigner",!0);var le;const Ie=class extends t.View{constructor(e){super();c(this,le,void 0);o(this,"_codeEditorController");o(this,"_codeSyncService");o(this,"_delayDocChangedTask");o(this,"_hasLoadSourceCode",!1);o(this,"_pendingGoto");this.ModelNode=e,this._codeEditorController=new ue.CodeEditorController(`${e.Label}.cs`,"",he.Default,e.Id),this._codeEditorController.ContextMenuBuilder=qe.BuildContextMenu,this._codeSyncService=new je(0,e.Id),this._delayDocChangedTask=new t.DelayTask(300,this.RunDelayTask.bind(this)),this.Child=Ie.BuildEditor(this._codeEditorController)}get ModelNode(){return h(this,le)}set ModelNode(e){m(this,le,e)}static BuildEditor(e){return new t.Column().Init({Children:[Ie.BuildActionBar(),new t.Expanded().Init({Child:new ue.CodeEditorWidget(e)})]})}static BuildActionBar(){return new t.Container().Init({BgColor:t.State.op_Implicit_From(new t.Color(4282137660)),Height:t.State.op_Implicit_From(40),Padding:t.State.op_Implicit_From(t.EdgeInsets.Only(15,8,15,8)),Child:new t.Row(t.VerticalAlignment.Middle,10).Init({Children:[new t.Button(t.State.op_Implicit_From("Run")).Init({Width:t.State.op_Implicit_From(75)}),new t.Button(t.State.op_Implicit_From("Debug")).Init({Width:t.State.op_Implicit_From(75)})]})})}OnMounted(){super.OnMounted(),this.TryLoadSourceCode()}async TryLoadSourceCode(){if(this._hasLoadSourceCode)return;this._hasLoadSourceCode=!0;let e=await I.Channel.Invoke("sys.DesignService.OpenCodeModel",[this.ModelNode.Id]);this._codeEditorController.Document.TextContent=e,this._codeEditorController.Document.DocumentChanged.Add(this.OnDocumentChanged,this),this._pendingGoto!=null&&(S.RunOnCodeEditor(this._codeEditorController,this._pendingGoto),this._pendingGoto=null)}OnDocumentChanged(e){this._codeSyncService.OnDocumentChanged(e),this._delayDocChangedTask.Run()}async RunDelayTask(){try{let e=await I.Channel.Invoke("sys.DesignService.GetProblems",[!1,this.ModelNode.Id]);a.UpdateProblems(this.ModelNode,e)}catch(e){t.Notification.Error(`GetProblems error: ${e.Message}`)}}Dispose(){super.Dispose(),this._hasLoadSourceCode&&this._codeEditorController.Document.DocumentChanged.Remove(this.OnDocumentChanged,this)}GetOutlinePad(){return null}GotoDefinition(e){if(e.Offset<0)return;this._codeEditorController.Document.TextLength==0?this._pendingGoto=e:S.RunOnCodeEditor(this._codeEditorController,e)}SaveAsync(){return I.Channel.Invoke("sys.DesignService.SaveModel",[this.ModelNode.Id])}async RefreshAsync(){let e=await I.Channel.Invoke("sys.DesignService.OpenCodeModel",[this.ModelNode.Id]);this._codeEditorController.Document.DocumentChanged.Remove(this.OnDocumentChanged,this),this._codeEditorController.Document.TextContent=e,this._codeEditorController.Document.DocumentChanged.Add(this.OnDocumentChanged,this)}};let Fe=Ie;le=new WeakMap,o(Fe,"$meta_AppBoxDesign_IModelDesigner",!0);class xe{constructor(e){o(this,"Widget");o(this,"Children");this.Widget=e,this.Children=new u.List,this.Widget.VisitChildren(i=>(this.Children.Add(new xe(i)),!1))}}class Vt{constructor(e){o(this,"ModelNode");o(this,"_invalidateAction");o(this,"_refreshOutlineAction");o(this,"CurrentWidget");this.ModelNode=e}set InvalidateAction(e){this._invalidateAction=e}get RefreshOutlineAction(){return this._refreshOutlineAction}set RefreshOutlineAction(e){this._refreshOutlineAction=e}Invalidate(){this._invalidateAction?.call(this)}GetWidgetTree(){return this.CurrentWidget==null?null:new xe(this.CurrentWidget)}}class Oe extends t.View{constructor(e){super();o(this,"_previewController");o(this,"_treeController",new t.TreeController(Oe.BuildTreeNode,e=>e.Children));o(this,"_searchKey",t.State.op_Implicit_From(""));o(this,"_inspector",null);this._previewController=e,this._treeController.SelectionChanged.Add(this.OnSelectedWidget,this),this.BuildWidgetTree(),this.Child=new t.Column().Init({Children:[new t.Input(this._searchKey).Init({Prefix:new t.Icon(t.State.op_Implicit_From(t.Icons.Filled.Search))}),new t.TreeView(this._treeController)]})}OnMounted(){this._previewController.RefreshOutlineAction=this.BuildWidgetTree.bind(this)}OnUnmounted(){this.ClearInspector(),this._previewController.RefreshOutlineAction=null}static BuildTreeNode(e,i){i.Icon=new t.Icon(t.State.op_Implicit_From(t.Icons.Filled.Folder)),i.Label=new t.Text(t.State.op_Implicit_From(e.Widget.toString())),i.IsLeaf=e.Children.length==0,i.IsExpanded=!i.IsLeaf}BuildWidgetTree(){this.ClearInspector(),this._treeController.DataSource=new u.List().Init([this._previewController.GetWidgetTree()])}ClearInspector(){this._inspector?.Remove(),this._inspector=null}OnSelectedWidget(){if(this._treeController.FirstSelectedNode==null){this.ClearInspector();return}this._inspector=t.Inspector.Show(this._treeController.FirstSelectedNode.Data.Widget)}}class Pt extends t.View{constructor(e){super();o(this,"_scale",t.Matrix4.CreateIdentity());this.Child=new t.Container().Init({BgColor:t.State.op_Implicit_From(new t.Color(4288848546)),Padding:t.State.op_Implicit_From(t.EdgeInsets.All(10)),Child:new t.Card().Init({Elevation:t.State.op_Implicit_From(10),Child:new t.Transform(this._scale.Clone()).Init({Child:new at(e)})})})}}var se;const Ce=class extends t.View{constructor(e){super();c(this,se,void 0);o(this,"_codeEditorController");o(this,"_codeSyncService");o(this,"_previewController");o(this,"_delayDocChangedTask");o(this,"_hasLoadSourceCode",!1);o(this,"_pendingGoto");this.ModelNode=e,this._previewController=new Vt(e),this._codeEditorController=new ue.CodeEditorController(`${e.Label}.cs`,"",he.Default,e.Id),this._codeEditorController.ContextMenuBuilder=qe.BuildContextMenu,this._codeSyncService=new je(0,e.Id),this._delayDocChangedTask=new t.DelayTask(300,this.RunDelayTask.bind(this)),this.Child=new t.Row().Init({Children:[new t.Expanded(Ce.BuildEditor(this._codeEditorController),2),new t.Expanded(new Pt(this._previewController),1)]})}get ModelNode(){return h(this,se)}set ModelNode(e){m(this,se,e)}static BuildEditor(e){return new t.Column().Init({Children:[Ce.BuildActionBar(),new t.Expanded().Init({Child:new ue.CodeEditorWidget(e)})]})}static BuildActionBar(){return new t.Container().Init({BgColor:t.State.op_Implicit_From(new t.Color(4282137660)),Height:t.State.op_Implicit_From(40),Padding:t.State.op_Implicit_From(t.EdgeInsets.Only(15,8,15,8)),Child:new t.Row(t.VerticalAlignment.Middle,10).Init({Children:[new t.Button(t.State.op_Implicit_From("Preview")).Init({Width:t.State.op_Implicit_From(75)}),new t.Button(t.State.op_Implicit_From("Debug")).Init({Width:t.State.op_Implicit_From(75)})]})})}OnMounted(){super.OnMounted(),this.TryLoadSourceCode()}async TryLoadSourceCode(){if(this._hasLoadSourceCode)return;this._hasLoadSourceCode=!0;let e=await I.Channel.Invoke("sys.DesignService.OpenCodeModel",[this.ModelNode.Id]);this._codeEditorController.Document.TextContent=e,this._codeEditorController.Document.DocumentChanged.Add(this.OnDocumentChanged,this),this._pendingGoto!=null&&(S.RunOnCodeEditor(this._codeEditorController,this._pendingGoto),this._pendingGoto=null)}OnDocumentChanged(e){this._codeSyncService.OnDocumentChanged(e),this._delayDocChangedTask.Run()}async RunDelayTask(){let e=await I.Channel.Invoke("sys.DesignService.GetProblems",[!1,this.ModelNode.Id]);a.UpdateProblems(this.ModelNode,e),e.Any(i=>i.IsError)||this._previewController.Invalidate()}Dispose(){super.Dispose(),this._hasLoadSourceCode&&this._codeEditorController.Document.DocumentChanged.Remove(this.OnDocumentChanged,this)}GetOutlinePad(){return new Oe(this._previewController)}GotoDefinition(e){if(e.Offset<0)return;this._codeEditorController.Document.TextLength==0?this._pendingGoto=e:S.RunOnCodeEditor(this._codeEditorController,e)}SaveAsync(){return I.Channel.Invoke("sys.DesignService.SaveModel",[this.ModelNode.Id])}async RefreshAsync(){let e=await I.Channel.Invoke("sys.DesignService.OpenCodeModel",[this.ModelNode.Id]);this._codeEditorController.Document.DocumentChanged.Remove(this.OnDocumentChanged,this),this._codeEditorController.Document.TextContent=e,this._codeEditorController.Document.DocumentChanged.Add(this.OnDocumentChanged,this)}};let fe=Ce;se=new WeakMap,o(fe,"$meta_AppBoxDesign_IModelDesigner",!0);class Wt extends t.View{constructor(){super();o(this,"_userName",t.State.op_Implicit_From(""));o(this,"_password",t.State.op_Implicit_From(""));o(this,"_inputSize",t.State.op_Implicit_From(20));this.Child=new t.Center().Init({Child:new t.Card().Init({Width:t.State.op_Implicit_From(400),Height:t.State.op_Implicit_From(330),Elevation:t.State.op_Implicit_From(20),Child:this.BuildLoginForm()})})}BuildLoginForm(){return new t.Container().Init({Padding:t.State.op_Implicit_From(t.EdgeInsets.All(30)),Child:new t.Column(t.HorizontalAlignment.Center,30).Init({Children:[new t.Text(t.State.op_Implicit_From("Welcome")).Init({FontSize:t.State.op_Implicit_From(50)}),new t.Input(this._userName).Init({HintText:"Account",FontSize:this._inputSize,Prefix:new t.Icon(t.State.op_Implicit_From(t.Icons.Filled.Person)).Init({Size:this._inputSize})}),new t.Input(this._password).Init({IsObscure:!0,HintText:"Password",FontSize:this._inputSize,Prefix:new t.Icon(t.State.op_Implicit_From(t.Icons.Filled.Lock)).Init({Size:this._inputSize})}),new t.Button(t.State.op_Implicit_From("Login")).Init({Width:t.State.op_Implicit_From(120),OnTap:e=>this.OnLogin()})]})})}async OnLogin(){try{await Ot.TryInit(),await I.Channel.Login(this._userName.Value,this._password.Value),this.CurrentNavigator.PushNamed("IDE")}catch(e){t.Notification.Error(`\u767B\u5F55\u9519\u8BEF: ${e.Message}`)}}}class Gt extends t.View{constructor(){super();this.Child=new t.Column().Init({Children:[new De,new t.Expanded().Init({Child:new t.Row().Init({Children:[new Dt,new t.Expanded().Init({Child:new t.Column().Init({Children:[new t.Expanded().Init({Child:new M}),new ce]})})]})}),new Nt]})}}class kt extends t.View{constructor(){super();let e=new t.Navigator(new u.List().Init([new t.Route("Login",i=>new Wt),new t.Route("IDE",i=>new Gt)]));this.Child=new t.RouteView(e)}}Ze();et();tt.Init(new it);t.WebApplication.Run(()=>new kt);
